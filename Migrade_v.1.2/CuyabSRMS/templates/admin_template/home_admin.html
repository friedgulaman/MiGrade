{% extends 'admin_template/admin_base.html' %}
{% block page_title %}
Home
{% endblock page_title %}

{% block main_content %}
<style>
  /* Styles for wrapping the search box */






  .dashboard-card {
    max-width: 200px;
    padding: 5px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    height: 100%;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  .dashboard-card:hover {
    animation: fadeIn .2s
  }

  .dashboard-card-text {
    font-size: clamp(8px, 2.5vw, 10px);
  }

  .dashboard-card-body {
    flex: 1;
  }

  .dashboard-card,
  .dashboard-card-text {
    text-align: center;
  }

  .search-box {
    max-width: 650px;
  }

  .search-icon {
    border: none;
    color: #1F3BB3;
  }

  .search-icon:hover {
    color: #000000;
    border-radius: 0;
  }

  /* Bootstrap 5 text input with search icon */

  .has-search .form-control {
    padding-left: 2.375rem;


  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  .logo {
    animation: fadeIn 1s;
  }

  .list_announcement {
    height: 200px;
    overflow: scroll;
    overflow-x: hidden;
  }

  .delete-record {
    text-decoration: none;
    cursor: pointer;
    color: red;
    border: none;
    background: none;
    transition: color 0.3s;
    /* Smooth color transition */

    /* Shake animation on hover */
    position: relative;
  }

  .delete-record:hover {
    color: darkred;
    /* Change color on hover */
    animation: shake 0.5s;
  }

  /* Define the shake animation */
  @keyframes shake {
    0% {
      transform: translateX(0);
    }

    25% {
      transform: translateX(-5px);
    }

    50% {
      transform: translateX(5px);
    }

    75% {
      transform: translateX(-5px);
    }

    100% {
      transform: translateX(0);
    }
  }

  #content {
    height: 155px;
  }
  /* .section{
    margin: auto;
    max-width: 900px;
  } */
  .title, .content{
    border: none;
    background: transparent;
  }

</style>
<section class="container m-3">

  <div class="container">
    <div class="p-3 d-flex justify-content-between align-items-center">
      <div>
        <h4 class="welcome-text">Welcome, <span class="text-black fw-bold">{{ user }}</span></h4>
    <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Modi quam omnis, id provident</p>
 </div>
 <div>
  <div id="datepicker-popup" class="input-group date datepicker navbar-date-picker border-0">
    <span class="input-group-addon input-group-prepend border-right">
      <span class="icon-calendar input-group-text calendar-icon" style="background-color: #1F3BB3;"></span>
    </span>
    <input type="text" class="form-control">
  </div>
 </div>
  </div>
    <div class="row justify-content-evenly">
      <div class="col-lg-6 card me-2 first-card p-5 d-flex justify-content-between align-items-center">
       <img src="static/star-admin/images/u_r_admin.svg"  style="width: 122px;">
      </div>
      <div class="col-5 ">
        <!-- Empty div to be populated -->
        <div class="row">
          <div class="col-6 p-3">
            <div class="card dashboard-card">
              <div class="card-body">
                <h6 class="card-title card-counter" data-value="{{ total_students }}">0</h6>
                <p class="card-text text-truncate">Students</p>
              </div>
            </div>
          </div>
          <div class="col-6 p-3">
            <div class="card dashboard-card">
              <div class="card-body">
                <h6 class="card-title card-counter text-danger" data-value="{{ total_teachers }}">0</h6>
                <p class="card-text text-truncate">Teachers</p>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-6 p-3">
            <div class="card dashboard-card">
              <div class="card-body">
                <h6 class="card-title card-counter" data-value="{{ total_grades }}">0</h6>
                <p class="card-text text-truncate">Grades</p>
              </div>
            </div>
          </div> 
          <div class="col-6 p-3">
            <div class="card dashboard-card">
              <div class="card-body">
                <h6 class="card-title card-counter text-success" data-value="{{ total_subjects }}">0</h6>
                <p class="card-text text-truncate">Subjects</p>
              </div>
            </div>
          </div>
        </div>
        </div>
    </div>
<div>


  <div class="card">
    <h1>User List</h1>
    <ul>
        {% for teacher in teachers %}
        <li><a href="{% url 'user_activity_log' teacher.id %}">{{ teacher.user }}</a></li>
        {% endfor %}
    </ul>
</div>

  <div class="row justify-content-evenly mt-4">
    <div class="col-lg-6 me-2 ">
      <div class="col-lg-6 grid-margin stretch-card p-2 d-flex justify-content-between align-items-center">
        <div class="mt-4">
          <div>
            <h5>No. of Enrollees</h5>
            <canvas id="studentsChart" width="400" height="200"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-5 card">
      <div class="row flex-grow">
        <div class="col-12 grid-margin stretch-card">
          <div class="card card-rounded">
            <div class="card-body">
              <div class="row">
                <div class="col-lg-12">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                      <h4 class="card-title card-title-dash">Activity Logs</h4>
                    </div>
                  </div>
                  <div class="mt-3">
                    <div class="wrapper d-flex align-items-center justify-content-between py-2 border-bottom">
                      <div class="d-flex">
                        <img class="img-sm rounded-10" src="images/faces/face1.jpg" alt="profile">
                        <div class="wrapper ms-3">
                          <p class="ms-1 mb-1 fw-bold">Brandon Washington</p>
                          <small class="text-muted mb-0">162543</small>
                        </div>
                      </div>
                      <div class="text-muted text-small">
                        1h ago
                      </div>
                    </div>
                    <div class="wrapper d-flex align-items-center justify-content-between py-2 border-bottom">
                      <div class="d-flex">
                        <img class="img-sm rounded-10" src="images/faces/face2.jpg" alt="profile">
                        <div class="wrapper ms-3">
                          <p class="ms-1 mb-1 fw-bold">Wayne Murphy</p>
                          <small class="text-muted mb-0">162543</small>
                        </div>
                      </div>
                      <div class="text-muted text-small">
                        1h ago
                      </div>
                    </div>
                    <div class="wrapper d-flex align-items-center justify-content-between py-2 border-bottom">
                      <div class="d-flex">
                        <img class="img-sm rounded-10" src="images/faces/face3.jpg" alt="profile">
                        <div class="wrapper ms-3">
                          <p class="ms-1 mb-1 fw-bold">Katherine Butler</p>
                          <small class="text-muted mb-0">162543</small>
                        </div>
                      </div>
                      <div class="text-muted text-small">
                        1h ago
                      </div>
                    </div>
                    <div class="wrapper d-flex align-items-center justify-content-between py-2 border-bottom">
                      <div class="d-flex">
                        <img class="img-sm rounded-10" src="images/faces/face4.jpg" alt="profile">
                        <div class="wrapper ms-3">
                          <p class="ms-1 mb-1 fw-bold">Matthew Bailey</p>
                          <small class="text-muted mb-0">162543</small>
                        </div>
                      </div>
                      <div class="text-muted text-small">
                        1h ago
                      </div>
                    </div>
                    <div class="wrapper d-flex align-items-center justify-content-between pt-2">
                      <div class="d-flex">
                        <img class="img-sm rounded-10" src="images/faces/face5.jpg" alt="profile">
                        <div class="wrapper ms-3">
                          <p class="ms-1 mb-1 fw-bold">Rafell John</p>
                          <small class="text-muted mb-0">Alaska, USA</small>
                        </div>
                      </div>
                      <div class="text-muted text-small">
                        1h ago
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>
  </div>







  </div>





  <div class="container mt-4 mb-1">
    <h5>Recently Post</h5>
    {% if success_message %}
    <div class="container alert alert-success" role="alert">
        {{ success_message }}
    </div>
{% endif %}

{% if error_message %}
    <div class="container alert alert-danger" role="alert">
        {{ error_message }}
    </div>
{% endif %}
  </div>
  <div class="container mb-5">
    <div class="bg-light list_announcement card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Content</th>
                            <th>Timestamp</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for announcement in announcements %}
                        <tr>
                            <td><textarea class="title" disabled>{{ announcement.title }}</textarea></td>
                            <td><textarea class="content" disabled>{{ announcement.content }}</textarea></td>
                            <td>{{ announcement.timestamp }}</td>
                            <td>
                              <form id="deleteForm{{ announcement.id }}" class="delete-form">
                                {% csrf_token %}
                                <button type="button" class="btn delete-record" data-id="{{ announcement.id }}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>



</section>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
$(document).ready(function() {
    $('.delete-record').click(function() {
        var announcementId = $(this).data('id');
        if (confirm('Are you sure you want to delete this announcement?')) {
            $.ajax({
                url: 'announcement/delete/' + announcementId + '/',
                method: 'POST',
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(response) {
                    if (response.success) {
                        alert(response.message);  // Display success message
                        // Optionally, you can remove the deleted announcement from the DOM
                        $('#deleteForm' + announcementId).closest('tr').remove();
                        window.location.href = 'home_admin';
                    } else {
                        alert(response.message);  // Display error message
                    }
                },
                error: function(xhr, status, error) {
                    alert('Failed to delete announcement: ' + error);  // Display error message
                }
            });
        }
    });
});
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var announcementButton = document.getElementById('announcementButton');
    announcementButton.addEventListener('click', function () {
      window.location.href = "{% url 'announcement' %}";
    });
  });


  $(document).ready(function () {
    // Fetch data using AJAX
    $.ajax({
      url: 'chart-data/',
      type: 'GET',
      dataType: 'json',
      success: function (data) {
        updateChart(data);
      },
      error: function (error) {
        console.error('Error fetching data:', error);
      }
    });

    // Function to update the Chart.js chart
    function updateChart(data) {
      const ctx = document.getElementById('studentsChart').getContext('2d');


      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Number of Students',
            data: data.values,
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1,

          }]
        },
        options: {
          scales: {
            x: {
              min: 0// This should make the x-axis start at zero
            },
            y: {
              beginAtZero: true
            }
          },
          layout: {
            padding: {
              left: 50, // Adjust the left padding to add more space
              right: 50,
              top: 0,
              bottom: 0
            }
          },
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          }
        }
      });
    }
    // Initial fetch and update
    fetchDataAndUpdateChart();

    // Set interval to fetch data and update the chart every 10 seconds
    setInterval(fetchDataAndUpdateChart, 10000);
  });
</script>
<script>
  $(document).ready(function(){
    // Function to animate the counter effect for card titles
    function animateCounter(selector, start, end) {
      $({ Counter: start }).animate({ Counter: end }, {
        duration: 2000,
        easing: 'swing',
        step: function () {
          $(selector).text(Math.ceil(this.Counter));
        }
      });
    }

    // Call the animateCounter function for each card title
    $('.card-counter').each(function() {
      var startValue = 0;
      var endValue = parseInt($(this).data('value'));
      animateCounter($(this), startValue, endValue);
    });
  });
</script>
{% endblock main_content %}