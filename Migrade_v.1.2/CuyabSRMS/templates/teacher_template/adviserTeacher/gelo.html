<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table within a Table</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }

        td {
            background-color: #ffffff;
        }
    </style>
</head>

<body>
    <form id="class_record">
    <table>
        <thead>
            <tr>
                <th contenteditable="true" colspan="3">Quarter:</th>
                <th contenteditable="true" colspan="14">Grade & Section:</th>
                <th contenteditable="true" colspan="13">Teacher:</th>
                <th contenteditable="true" colspan="4">Subject:</th>
            </tr>
        </thead>
        <tbody id="nameRows">
            <tr id="row1">
                <td colspan="2">LEARNER`S NAME</td>
                <td colspan="13">WRITTEN WORKS (30%)</td>
                <td colspan="13">PERFORMANCE TASKS (50%)</td>
                <td colspan="4">QUARTERLY ASSESSMENT(20%)</td>
                <td rowspan="2">Initial Grade</td>
                <td rowspan="2">Quarterly Grade</td>
            </tr>
            <tr id="row2"> 
                <th class="number"></th>
                <th></th>
                <th class="ww-hps">1</th>
                <th class="ww-hps">2</th>
                <th class="ww-hps">3</th>
                <th class="ww-hps">4</th>
                <th class="ww-hps">5</th>
                <th class="ww-hps">6</th>
                <th class="ww-hps">7</th>
                <th class="ww-hps">8</th>
                <th class="ww-hps">9</th>
                <th class="ww-hps">10</th>
                <th class="ww-hps">Total</th>
                <th class="ww-hps">PS</th>
                <th class="ww-hps">WS</th>
                <th class="pt-hps">1</th>
                <th class="pt-hps">2</th>
                <th class="pt-hps">3</th>
                <th class="pt-hps">4</th>
                <th class="pt-hps">5</th>
                <th class="pt-hps">6</th>
                <th class="pt-hps">7</th>
                <th class="pt-hps">8</th>
                <th class="pt-hps">9</th>
                <th class="pt-hps">10</th>
                <th class="pt-hps">Total</th>
                <th class="pt-hps">PS</th>
                <th class="pt-hps">WS</th>
                <th class="qa-hps">1</th>
                <th class="qa-hps">2</th>
                <th class="qa-hps">PS</th>
                <th class="qa-hps">WS</th>    
            </tr>
            <tr id="row3-hps">
                <td></td>
                <td class="hps" align="right">HIGHEST POSSIBLE SCORE</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="false">100%</td>
                <td contenteditable="false">30%</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="false">100%</td>
                <td contenteditable="false">30%</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>    
            </tr>
        </tbody>
        <tbody id="maleRows" class="gender-rows male">
            <tr class="male">
                <td></td>
                <td class="hps" align="right">Male <button id="addMaleRowButton">+</button></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="false"></td>
                <td contenteditable="false"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="false"></td>
                <td contenteditable="false"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>    
            </tr>
        </tbody>
        <tbody id="femaleRows" class="gender-rows female">
            <tr class="female">
                <td></td>
                <td class="hps" align="right">Female <button id="addFemaleRowButton">+</button></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="false"></td>
                <td contenteditable="false"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="false"></td>
                <td contenteditable="false"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td> 
            </tr>
        </tbody>
    </table>
    <button type="submit">Submit</button>
    </form>

    <script>

        function calculateTotalForRow3HPS(startColumn, endColumn) {
            var row3HPS = document.querySelector("#row3-hps");
            var total = 0;
            for (var i = startColumn; i <= endColumn; i++) {
                var cellValue = parseFloat(row3HPS.cells[i].textContent) || 0;
                total += cellValue;
            }
            return total;
        }

        // Function to update totals in row3-hps
        function updateRow3HPSTotals() {
            // Calculate totals for columns 2 to 11 and insert into cell 12
            var totalMaleRow3 = calculateTotalForRow3HPS(2, 11);
            document.querySelector("#row3-hps td:nth-child(13)").textContent = totalMaleRow3;

            // Calculate totals for columns 15 to 24 and insert into cell 25
            var totalFemaleRow3 = calculateTotalForRow3HPS(15, 24);
            document.querySelector("#row3-hps td:nth-child(26)").textContent = totalFemaleRow3;
        }

        // Add event listeners to editable cells in row3-hps
        document.querySelectorAll("#row3-hps [contenteditable=true]").forEach(function(cell) {
            cell.addEventListener("input", function(event) {
                updateRow3HPSTotals();
            });
        });
        function calculateTotalForRow(row, startColumn, endColumn) {
        var total = 0;
        for (var i = startColumn; i <= endColumn; i++) {
            var cellValue = parseFloat(row.cells[i].textContent) || 0;
            total += cellValue;
        }
        return total;
    }

    function updateTotals() {
    var rows = document.querySelectorAll("#maleRows tr.male, #femaleRows tr.female");
    var totalMaleRow3 = calculateTotalForRow(document.querySelector("#row3-hps"), 2, 11);
    var totalFemaleRow3 = calculateTotalForRow(document.querySelector("#row3-hps"), 15, 24);

    // Update the total cell 12 in row3-hps
    document.querySelector("#row3-hps td:nth-child(13)").textContent = totalMaleRow3;
    document.querySelector("#row3-hps td:nth-child(26)").textContent = totalFemaleRow3;

    rows.forEach(function(row) {
        // Skip rows with buttons (Male + and Female +)
        if (row.querySelector("button")) {
            return;
        }

        // Calculate totals for columns 2 to 11
        var total1 = calculateTotalForRow(row, 2, 11);
        row.cells[12].textContent = total1;

        // Calculate totals for columns 15 to 24
        var total2 = calculateTotalForRow(row, 15, 24);
        row.cells[25].textContent = total2;

        var ps1 = (total1 / totalMaleRow3) * 100;
        var ps2 = (total2 / totalFemaleRow3) * 100;

        row.cells[13].textContent = (ps1 || 0).toFixed(2);
        row.cells[26].textContent = (ps2 || 0).toFixed(2);
    });
}

function calculateTotalForRow(row, startColumn, endColumn) {
    var total = 0;
    for (var i = startColumn; i <= endColumn; i++) {
        var cell = row.cells[i].textContent.trim();
        if (cell !== "" && !isNaN(cell)) {
            total += parseFloat(cell);
        }
    }
    return total;
}

// Add event listeners to existing editable cells in male and female rows
document.querySelectorAll("#maleRows [contenteditable=true], #femaleRows [contenteditable=true]").forEach(function(cell) {
    cell.addEventListener("input", function(event) {
        updateTotals();
    });
});


        
        var maleRowNumber = 1;
        var femaleRowNumber = 1;

        document.getElementById("addMaleRowButton").addEventListener("click", function() {
            event.preventDefault();
            addRow("male", maleRowNumber);
            maleRowNumber++;
        });

        document.getElementById("addFemaleRowButton").addEventListener("click", function() {
            event.preventDefault();
            addRow("female", femaleRowNumber);
               event.preventDefault();
            femaleRowNumber++;
        });

        function addRow(gender, rowNumber) {
            var targetRows;
            if (gender === "male") {
                targetRows = document.getElementById("maleRows");
            } else if (gender === "female") {
                targetRows = document.getElementById("femaleRows");
            }

            var newRow = document.createElement("tr");
            newRow.className = gender;
            newRow.innerHTML = `
                <td class="number">${rowNumber}</td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>   
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
                <td contenteditable="true"></td>
            `;

            targetRows.appendChild(newRow);

            newRow.querySelectorAll("[contenteditable=true]").forEach(function(cell) {
        cell.addEventListener("input", function(event) {
            updateTotals();
        });
    });

    // Update totals after adding a new row
    updateTotals();
    }

    document.getElementById("class_record").addEventListener("submit", function(event) {
    event.preventDefault();

    var tableData = [];
    var rows = document.querySelectorAll("#maleRows tr, #femaleRows tr");
    rows.forEach(function(row, index) {
        var rowData = {};
        var cells = row.querySelectorAll("[contenteditable=true]");
        cells.forEach(function(cell, index) {
            var columnName = getColumnHeader(index);
            rowData[columnName] = cell.textContent;
        });
        

        // Create a new object with "Learner's Name" and "Gender" properties
        var learnerNameObj = {
            "Number": row.cells[0].textContent,
            "Learner's Name": row.cells[1].textContent,
            "Gender": row.classList.contains("male") ? "Male" : "Female",
            // Add other properties as needed
        };

        // Merge the learnerNameObj with the existing rowData object
        rowData = { ...learnerNameObj, ...rowData };

        tableData.push(rowData);
    });

    var jsonData = JSON.stringify(tableData, null, 2);

    // Create a Blob containing the JSON data
    var blob = new Blob([jsonData], { type: "text/plain" });

    // Create a download link and trigger the download
    var url = window.URL.createObjectURL(blob);
    var a = document.createElement("a");
    a.href = url;
    a.download = "form_data.json";
    a.click();

    // Clean up
    window.URL.revokeObjectURL(url);
});

        function getColumnHeader(index) {
            // This function returns the column header based on the index
            // You need to customize this logic based on your table structure
            // For example, you can store column headers in an array and return the header at the given index.
            // For now, I'm returning a generic column header name (Column 1, Column 2, etc.)
            return "Column " + (index + 1);
        }
    </script>
</body>

</html>
</body>

</html>
